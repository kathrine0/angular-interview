<div class="exercise-container">
  <mat-card appearance="outlined">
    <mat-card-header>
      <mat-card-title>Exercise 2: Forms & ControlValueAccessor</mat-card-title>
      <mat-card-subtitle>Fix the custom form components</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <p>
        This form uses a custom rating component that is <strong>not working correctly</strong>
        Your task is to fix it!
      </p>
      <mat-divider></mat-divider>
      <div class="problem-indicators">
        <p><strong>ðŸ”´ Problems you should notice:</strong></p>
        <ul>
          <li>The "Fill Sample Data" button doesn't update the rating</li>
          <li>Form submission doesn't include correct rating value</li>
          <li>Reset button doesn't clear the rating</li>
          <li>Disable button doesn't disable the rating component</li>
          <li>Form validation doesn't work properly with the rating component</li>
        </ul>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card appearance="outlined">
    <mat-card-header>
      <mat-card-title>User Feedback Form</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="feedbackForm" (ngSubmit)="onSubmit()">
        <mat-form-field appearance="outline">
          <mat-label>Name</mat-label>
          <input matInput [formControl]="feedbackForm.controls.name" placeholder="Enter your name">
          @if (feedbackForm.controls.name.hasError('required') && feedbackForm.get('name')?.touched) {
            <mat-error>Name is required</mat-error>
          }
          @if (feedbackForm.controls.name.hasError('minlength')) {
            <mat-error>Name must be at least 2 characters</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput type="email" [formControl]="feedbackForm.controls.email" placeholder="Enter your email">
          @if (feedbackForm.controls.email.hasError('required') && feedbackForm.controls.email.touched) {
            <mat-error>Email is required</mat-error>
          }
          @if (feedbackForm.controls.email.hasError('email')) {
            <mat-error>Please enter a valid email</mat-error>
          }
        </mat-form-field>

        <!-- Rating Field (Custom Component - BROKEN) -->
        <div class="rating-field">
          <label class="mat-body-strong">
            Rating <span class="required-asterisk">*</span>
          </label>
          <app-rating-input></app-rating-input>
          @if (feedbackForm.controls.rating.hasError('required') && feedbackForm.controls.rating.touched) {
            <mat-error>Rating is required</mat-error>
          }
          @if (feedbackForm.controls.rating.hasError('min')) {
            <mat-error>Please select at least 1 star</mat-error>
          }
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Message</mat-label>
          <textarea
            matInput
            [formControl]="feedbackForm.controls.message"
            rows="4"
            placeholder="Enter your feedback message">
          </textarea>
          @if (feedbackForm.controls.message.hasError('required') && feedbackForm.controls.message.touched) {
            <mat-error>Message is required</mat-error>
          }
          @if (feedbackForm.controls.message.hasError('minlength')) {
            <mat-error>Message must be at least 10 characters</mat-error>
          }
        </mat-form-field>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit">
            Submit Feedback
          </button>
          <button mat-button type="button" (click)="resetForm()">
            Reset
          </button>
          <button mat-button type="button" (click)="fillSampleData()">
            Fill Sample Data
          </button>
          <button mat-button type="button" (click)="toggleFormState()">
            {{ feedbackForm.enabled ? 'Disable' : 'Enable' }} Form
          </button>
        </div>

        <mat-divider></mat-divider>

        <div class="debug-info">
          <h4 class="mat-subtitle-1">Debug Information</h4>
          <div class="debug-row">
            <strong class="mat-body-strong">Form Status:</strong>
            <span class="mat-body-1" [class.valid]="feedbackForm.valid" [class.invalid]="feedbackForm.invalid">
              {{ feedbackForm.valid ? 'âœ“ Valid' : 'âœ— Invalid' }}
            </span>
          </div>
          <div class="debug-row">
            <strong class="mat-body-strong">Form Value:</strong>
            <pre class="mat-body-1">{{ feedbackForm.value | json }}</pre>
          </div>
          <div class="debug-row">
            <strong class="mat-body-strong">Form Errors:</strong>
            <pre class="mat-body-1">{{ getFormErrors() | json }}</pre>
          </div>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
